{% extends "layout_dashboard.html" %}

{% block title %}Punto de Venta - Fruter√≠a{% endblock %}

{% block content %}
<div class="container-fluid h-100 p-0">
    <div class="row g-0 h-100">
        <div class="col-lg-8 p-4 bg-light d-flex flex-column h-100" style="min-height: 100vh;">
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="fw-bold mb-0">Cat√°logo</h2>
                    <div class="search-bar w-50">
                        <i class="bi bi-search"></i>
                        <input type="text" id="searchInput" placeholder="Buscar fruta, verdura..." class="form-control rounded-pill ps-5">
                    </div>
                </div>
                
                <div class="d-flex gap-2 overflow-auto pb-2" id="categoryFilters">
                    <span class="category-pill active" data-category="all">Todas</span>
                    <span class="category-pill" data-category="fruta">Frutas</span>
                    <span class="category-pill" data-category="verdura">Verduras</span>
                </div>
            </div>

            <div class="pos-grid flex-grow-1 overflow-auto pe-2" id="productGrid">
                {% for p in productos %}
                <div class="product-card" 
                     data-codigo="{{ p.codigo }}" 
                     data-nombre="{{ p.descripcion }}" 
                     data-precio="{{ p.precio_v }}" 
                     data-stock="{{ p.existencia }}"
                     data-category="{{ p.categoria }}">
                    <div class="product-img-wrapper">
                        {% if p.categoria == 'fruta' %}
                            üçé
                        {% elif p.categoria == 'verdura' %}
                            ü•¶
                        {% else %}
                            üì¶
                        {% endif %}
                    </div>
                    <h6 class="fw-bold mb-1 text-truncate">{{ p.descripcion }}</h6>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <span class="text-primary fw-bold">${{ p.precio_v }}</span>
                        <small class="text-muted">{{ p.unidad_medida }}</small>
                    </div>
                    {% if p.existencia < 10 %}
                        <div class="badge bg-danger-subtle text-danger mt-2 w-100">Poco Stock: {{ p.existencia }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-4 bg-white border-start d-flex flex-column h-100 shadow-lg" style="position: fixed; right: 0; top: 0; bottom: 0; width: 33.33333%; z-index: 101;">
            <div class="p-4 border-bottom bg-white">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">Ticket de Venta</h5>
                    <span class="badge bg-primary-subtle text-primary rounded-pill" id="itemsCount">0 items</span>
                </div>
                
                <div class="mb-2">
                    <select class="form-select form-select-sm bg-light border-0" id="selectCliente">
                        <option value="" selected disabled>Seleccionar Cliente...</option>
                        {% for c in clientes %}
                        <option value="{{ c.id_c }}">{{ c.nombre_cliente }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="d-flex justify-content-between text-muted small">
                    <span id="fechaActual"></span>
                    <span>{{ current_user.username }}</span>
                </div>
            </div>

            <div class="flex-grow-1 overflow-auto p-3" id="ticketItems">
                <div class="text-center py-5 text-muted" id="emptyState">
                    <i class="bi bi-basket fs-1 mb-3 d-block opacity-25"></i>
                    <p>Selecciona productos para agregar</p>
                </div>
            </div>

            <div class="p-4 bg-light border-top mt-auto">
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Subtotal</span>
                    <span class="fw-bold" id="subtotalDisplay">$0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-4">
                    <span class="h4 fw-bold mb-0">Total</span>
                    <span class="h3 fw-bold text-primary mb-0" id="totalDisplay">$0.00</span>
                </div>
                
                <button class="btn btn-secondary-custom w-100 py-3 fs-5 fw-bold shadow-sm" id="btnFinalizar">
                    COBRAR (F9)
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quantity Modal (Hidden by default, used for manual input if needed, or we can use inline controls) -->
<!-- For this design, we'll use inline controls in the ticket item -->

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ventas.js') }}"></script>
{% endblock %}
